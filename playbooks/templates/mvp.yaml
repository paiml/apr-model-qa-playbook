# MVP (Minimum Viable Product) Certification Playbook
# Tests all format × backend × modality combinations (18 total)
# Answers: "Does this model work in all supported configurations?"
#
# Coverage: 3 formats × 2 backends × 3 modalities = 18 combinations
# Duration: ~5-10 minutes per model
# Use case: Pre-release sanity, new format verification, quick regression

name: mvp-certification
version: "1.0.0"
description: "Full surface coverage - all formats, backends, and modalities"

model:
  hf_repo: "${MODEL_ID}"
  formats:
    - safetensors  # Ground truth (HuggingFace source)
    - apr          # APR native format
    - gguf         # Third-party format
  quantizations:
    - q4_k_m
  size_category: auto

test_matrix:
  modalities:
    - run
    - chat
    - serve
  backends:
    - cpu
    - gpu
  scenario_count: 1  # 1 per combination = 18 total
  seed: 42
  timeout_ms: 120000

gates:
  g1_model_loads: true
  g2_basic_inference: true
  g3_no_crashes: true
  g4_output_quality: true

oracles:
  - type: arithmetic
    config:
      tolerance: 0.01
  - type: garbage
    config:
      max_repetition_ratio: 0.3
      min_unique_chars: 10
  - type: response
    config:
      min_relevance: 0.2

# MVP-specific tests: one per combination
# SafeTensors first (ground truth), then APR, then GGUF
mvp_matrix:
  # Format × Backend × Modality (safetensors = ground truth)
  - { format: safetensors, backend: cpu, modality: run, prompt: "What is 2+2?" }
  - { format: safetensors, backend: cpu, modality: chat, prompt: "Hello, how are you?" }
  - { format: safetensors, backend: cpu, modality: serve, prompt: "List 3 colors" }
  - { format: safetensors, backend: gpu, modality: run, prompt: "What is 3+3?" }
  - { format: safetensors, backend: gpu, modality: chat, prompt: "What is Python?" }
  - { format: safetensors, backend: gpu, modality: serve, prompt: "List 3 numbers" }
  - { format: apr, backend: cpu, modality: run, prompt: "What is 4+4?" }
  - { format: apr, backend: cpu, modality: chat, prompt: "Explain recursion" }
  - { format: apr, backend: cpu, modality: serve, prompt: "List 3 animals" }
  - { format: apr, backend: gpu, modality: run, prompt: "What is 5+5?" }
  - { format: apr, backend: gpu, modality: chat, prompt: "What is Rust?" }
  - { format: apr, backend: gpu, modality: serve, prompt: "List 3 fruits" }
  - { format: gguf, backend: cpu, modality: run, prompt: "What is 6+6?" }
  - { format: gguf, backend: cpu, modality: chat, prompt: "Hello world" }
  - { format: gguf, backend: cpu, modality: serve, prompt: "List 3 cities" }
  - { format: gguf, backend: gpu, modality: run, prompt: "What is 7+7?" }
  - { format: gguf, backend: gpu, modality: chat, prompt: "What is Go?" }
  - { format: gguf, backend: gpu, modality: serve, prompt: "List 3 countries" }

failure_policy: collect_all  # Run all 18, don't stop on first failure

metadata:
  author: "apr-qa"
  tier: "mvp"
  purpose: "Full surface coverage verification"
  estimated_time: "5-10 minutes"
  tags:
    - mvp
    - surface-coverage
    - pre-release
